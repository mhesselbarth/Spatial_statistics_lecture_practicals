<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Wiegand, Getzin, Hesselbarth" />


<title>Homogenous null model</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Spatial statistics</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="data.html">
    <span class="fa fa-database"></span>
     
    Data
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-tasks"></span>
     
    Practicals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Practical_homo_1.html">
        <span class="fa fa-tasks"></span>
         
        Practical 1
      </a>
    </li>
    <li>
      <a href="Practical_homo_2.html">
        <span class="fa fa-tasks"></span>
         
        Practical 2
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-check"></span>
     
    Solutions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Solution_homo_1.html">
        <span class="fa fa-clipboard-check"></span>
         
        Solution 1
      </a>
    </li>
    <li>
      <a href="Solution_homo_2.html">
        <span class="fa fa-clipboard-check"></span>
         
        Solution 2
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-plus-square"></span>
     
    Additional material
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
        <span class="fa fa-tasks"></span>
         
        Practicals
      </a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="Practical_1st_order.html">
            <span class="fa fa-tasks"></span>
             
            1st order properties
          </a>
        </li>
        <li>
          <a href="Practical_advanced.html">
            <span class="fa fa-tasks"></span>
             
            Advanced SPPA
          </a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
        <span class="fa fa-check"></span>
         
        Solutions
      </a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="Solution_1st_order.html">
            <span class="fa fa-clipboard-check"></span>
             
            1st order properties
          </a>
        </li>
        <li>
          <a href="Solution_advanced.html">
            <span class="fa fa-clipboard-check"></span>
             
            Advanced SPPA
          </a>
        </li>
      </ul>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-ellipsis-h"></span>
     
    More...
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://mhesselbarth.rbind.io">
        <span class="fa fa-user"></span>
         
        Contact
      </a>
    </li>
    <li>
      <a href="https://github.com/mhesselbarth/spatial_statistics_practicals">
        <span class="fa fa-github fa-lg"></span>
         
        Github
      </a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Homogenous null model</h1>
<h4 class="author">Wiegand, Getzin, Hesselbarth</h4>
<h4 class="date">Summer semester 2020</h4>

</div>


<p><br></p>
<p><img src="logo.png" width="182" /></p>
<p>First, we load all packages, just as before.</p>
<pre class="r"><code>  library(spatstat)
  library(tidyverse)</code></pre>
<div id="exercise-5" class="section level3">
<h3>Exercise 5</h3>
<p><strong>Task:</strong> Calculate the bivariate g12 function using the null model random labeling. Was the process that labeled trees as dead or alive a random process.</p>
<p>In case it is not in our workspace anymore, we import the data and convert it to a <code>ppp</code> object again.</p>
<pre class="r"><code>  douglas_fir &lt;- read_delim(file = &quot;Data/DouglasFir_LiveDead_OGN.txt&quot;, 
                            delim = &quot;;&quot;)
  
  douglas_fir &lt;- mutate(douglas_fir,
                        mark = case_when(mark == 1 ~ &quot;alive&quot;,
                                         mark == 2 ~ &quot;dead&quot;),
                        mark = as.factor(mark))
  
  plot_area &lt;- ripras(x = douglas_fir$x, y = douglas_fir$y, 
                      shape = &quot;rectangle&quot;)
  
  douglas_fir_ppp &lt;- as.ppp(X = douglas_fir, W = plot_area)</code></pre>
<p>The same goes for the O-ring statistic.</p>
<pre class="r"><code>  Oest &lt;- function(input, r = NULL, 
                   correction = &quot;Ripley&quot;, divisor = &quot;d&quot;, ...){
    
    p_fct &lt;- pcf(input, r = r, 
                 correction = correction, divisor = divisor, ...)
    
    lambda &lt;- intensity(unmark(input))
    
    eval.fv(p_fct * lambda)
  }</code></pre>
<p>The function <code>envelope()</code> can also be used to simulate more complex null models than ‘CSR’ and basically all functions (<code>fun</code>) that return a <code>fv</code> object. This time, we use the bivariate pair-correlation function as <code>fun</code> called <code>pcfcross</code> in <code>spatstat</code>. We need to specify the arguments of <code>pcfcross</code> <code>i</code> and <code>j</code> indicating the two types of marks. <code>simulate</code> allows us to specify any possible null model as an expression. Random labeling can be simulated with the help of <code>rlabel</code>. Lastly, we specify the number of simulation (<code>nsim</code>) and the highest/lowest values to use for the envelopes (<code>nrank</code>) and the distances at which the function should be evaluated (<code>r</code>) just as before.</p>
<pre class="r"><code>  random_labeling &lt;- envelope(douglas_fir_ppp, 
                              fun = pcfcross, 
                              i = &quot;alive&quot;,  j = &quot;dead&quot;,
                              r = seq(from = 0, to = 45, by = 0.5),
                              divisor = &quot;d&quot;, nsim = 199, nrank = 5,
                              simulate = expression(rlabel(douglas_fir_ppp)))</code></pre>
<p>If we visualise the null model data, we see that during the randomisation the location of all events stay unchanged and only the marks are randomly shuffled acroos the events.</p>
<p><img src="Solution_homo_2_files/figure-html/visualization_null_model_rl-1.gif" width="65%" style="display: block; margin: auto;" /></p>
<p>The results can be visualised using the <code>plot()</code> function.</p>
<p><img src="Solution_homo_2_files/figure-html/solution_2_plot_envelope-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise-6" class="section level3">
<h3>Exercise 6</h3>
<p><strong>Task:</strong> Redo the analysis from 5) and try out different settings for the number of simulations and the used lowest/highest values (e.g. n = 39, 199, 499 and lowest/highest = 1, 5, 10). Do the results change?</p>
<p>All we need to do is change the <code>nsim</code> and the <code>nrank</code> argument of the <code>envelope()</code> function and save the results in order to compare them later. In order to avoid typing the same code all the time, we are going to create a <code>tibble</code> with all possible parameter combinations first and then loop through this <code>tibble</code>. We are going to use the <code>map()</code> function from the <code>purrr</code>-package. The function is an easy way to create a loop and the result is type stable (i.e. a <code>list</code>). We can then convert this <code>list</code> to a <code>tibble</code> again and use e.g. <code>ggplot2</code> to create a nice overview plot.</p>
<pre class="r"><code>nsim &lt;- c(39, 199, 499)
nrank &lt;- c(1, 5, 10)

param_envelopes &lt;- expand.grid(nsim = nsim, nrank = nrank)

param_envelopes &lt;- arrange(param_envelopes, nsim, nrank)

random_labeling_multiple &lt;- purrr::map(1:nrow(param_envelopes), function(i) {

  as_tibble(envelope(douglas_fir_ppp,
                     fun = pcfcross,
                     i = &quot;alive&quot;,  j = &quot;dead&quot;,
                     r = seq(from = 0, to = 45, by = 0.5),
                     divisor = &quot;d&quot;, nsim = param_envelopes[i, 1], nrank = param_envelopes[i, 2],
                     simulate = expression(rlabel(douglas_fir_ppp))))
})

names(random_labeling_multiple) &lt;- paste0(&quot;nsim_&quot;, param_envelopes$nsim, &quot;_nrank_&quot;, param_envelopes$nrank)

random_labeling_multiple &lt;- bind_rows(random_labeling_multiple, .id = &quot;id&quot;)</code></pre>
<pre class="r"><code>  ggplot(data = random_labeling_multiple) +
    geom_ribbon(aes(x = r, ymin = lo, ymax = hi, fill = &quot;Simulation envelope&quot;), alpha = 0.75) +
    geom_line(aes(x = r, y = obs, col = &quot;Observed value&quot;)) +
    scale_fill_manual(name = &quot;&quot;, values = c(&quot;Simulation envelope&quot; = &quot;grey&quot;)) +
    scale_colour_manual(name = &quot;&quot;, values = c(&quot;Observed value&quot; = &quot;black&quot;)) +
    facet_wrap(~id) +
    theme_classic()</code></pre>
<p><img src="Solution_homo_2_files/figure-html/solution_2_plot_different_envelope-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise-7" class="section level3">
<h3>Exercise 7</h3>
<p><strong>Task:</strong> Now use the data set <em>DouglasFir_Adult_vs_Seedling_OGN</em>. Here, pattern 1 gives the locations of adult trees and pattern 2 gives the locations of seedlings. Calculate <span class="math inline">\(O_{12}(r)\)</span> and generate 95% confidence envelopes for the null model antecedent conditions (Pattern 1: fixed, pattern 2: random). What would be a meaningful interpretation of the results?</p>
<p>Firstly, we import the data and convert it to a <code>ppp</code> object. Also, we reclassify the mark column to 1 == ‘adults’ and 2 == ‘seedlings’ and convert it as a factor.</p>
<pre class="r"><code>  douglas_fir &lt;- read_delim(file = &quot;Data/DouglasFir_Adult_vs_Seedling_OGN.txt&quot;, 
                            delim = &quot;;&quot;)
  
  douglas_fir &lt;- mutate(douglas_fir,
                        mark = case_when(mark == 1 ~ &quot;adults&quot;,
                                         mark == 2 ~ &quot;seedlings&quot;),
                        mark = as.factor(mark))
  
  plot_area &lt;- ripras(x = douglas_fir$x, y = douglas_fir$y, 
                      shape = &quot;rectangle&quot;)
  
  douglas_fir_ppp &lt;- as.ppp(X = douglas_fir, W = plot_area)</code></pre>
<p><img src="Solution_homo_2_files/figure-html/solution_2_plot_snd_data-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now, we need to implement the bivariate O-ring statistic O12(r). We want to multiply the bivariate pair-correlation function g12(r) with the intensity of lambda2.</p>
<pre class="r"><code>Oest_cross &lt;- function(input, i, j, r = NULL,
                       correction = &quot;Ripley&quot;, divisor = &quot;d&quot;, ...){
  
  gij &lt;- pcfcross(input, 
                  i = i, j = j, r = r,
                  correction = correction, divisor = divisor, ...)
  
  lambda &lt;- intensity(input)[j]
  
  eval.fv(gij * lambda)
}</code></pre>
<p><code>spatstat</code> has no build-in function to simulate a null model of ‘antecedent conditions’. But remember, we can give the <code>simulate</code> argument of the <code>envelope()</code> function a list of patterns. Therefore, we just need to simulate the null model and save the results in a list.</p>
<p>After splitting the point pattern into seedlings and adults, we create a new, random pattern with the same number of points (<code>n</code>) and the same observation window (<code>win</code>) as the seedlings. Then, we superimpose the random seedlings with the unchanged adults. Lastly, we save the result in a list.</p>
<pre class="r"><code>null_model_pattern &lt;- list()

seedlings &lt;- subset.ppp(douglas_fir_ppp, 
                          marks == &quot;seedlings&quot;, drop = TRUE)
  
adults &lt;- subset.ppp(douglas_fir_ppp, marks == &quot;adults&quot;, drop = TRUE)

for (i in 1:199) {
  
  random_seedlings &lt;- rpoint(n = seedlings$n,
                             win = seedlings$window)
  
  overall_pattern &lt;- superimpose(adults = unmark(adults),
                                 seedlings = random_seedlings)
  
  null_model_pattern[i] &lt;- list(overall_pattern)
}</code></pre>
<p>If we visualise the null model patterns, we can see that the location of all adult trees does not change, but the the location of all seedlings is randomised using CSR.</p>
<p><img src="Solution_homo_2_files/figure-html/visualization_null_model_antecedent-1.gif" width="65%" style="display: block; margin: auto;" /></p>
<p>Now, we can compute the simulation envelopes as usually.</p>
<pre class="r"><code>  antecedent_conditions &lt;- envelope(douglas_fir_ppp, 
                                    fun = Oest_cross, 
                                    i = &quot;adults&quot;, j = &quot;seedlings&quot;,
                                    r = seq(from = 0, to = 45, 
                                            by = 0.5),
                                    nsim = 199,  nrank = 5,
                                    simulate = null_model_pattern)</code></pre>
<p><img src="Solution_homo_2_files/figure-html/unnamed-chunk-1-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The <a href="https://r-spatialecology.github.io/onpoint/"><code>onpoint</code></a> package also includes an function to simulate antecedent conditions as null model (see <code>?simulate_antecedent_conditions</code> for help).</p>
</div>
<div id="exercise-8" class="section level3">
<h3>Exercise 8</h3>
<p><strong>Task:</strong> How does the interpretation of the ‘Toroidal shift’ null model differ from the null models in 7)? What is the advantage? Is it always an advantage?</p>
<p>There is a possibility to simulate the ‘toroidal shift’ null model with functions provided by <code>spatstat</code>. We just use the function <code>rshift()</code> and specify the behavior at the edge of the observation area (<code>edge</code>) and which points should be shifted (<code>which</code>).</p>
<p>If we visualise the null model data, we see that the location of all adult trees is identical between the simulations. However, the location of the seedlings are randomised. Using the toroidal shift, you can see that the overall spatial structure of the seedlings is preserved</p>
<p><img src="Solution_homo_2_files/figure-html/visualization_null_model_toroidal-1.gif" width="65%" style="display: block; margin: auto;" /></p>
<pre class="r"><code>toroidal_shift &lt;- envelope(douglas_fir_ppp, fun = Oest_cross, 
                           i = &quot;adults&quot;, j = &quot;seedlings&quot;,
                           r = seq(from = 0, to = 45, by = 0.5),
                           nsim = 199, nrank = 5,
                           simulate = expression(rshift(douglas_fir_ppp,
                                                        which = &quot;seedlings&quot;, 
                                                        edge = &quot;torus&quot;)))</code></pre>
<p><img src="Solution_homo_2_files/figure-html/solution_2_plot_toroidal-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>References</strong>:</p>
<p>Baddeley, A., Rubak, E., Turner, R., 2015. Spatial point patterns: Methodology and applications with R. Chapman and Hall/CRC Press, London.</p>
<p>Getzin, S., Dean, C., He, F., Trofymow, J.A., Wiegand, K., Wiegand, T., 2006. Spatial patterns and competition of tree species in a Douglas fir chronosequence on Vancouver Island. Ecography, 29, 671-682.</p>
<p>Getzin, S., Wiegand, T., Wiegand, K., He, F., 2008. Heterogeneity influences spatial patterns and demographics in forest stands. J. Ecol. 96, 807-820.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
